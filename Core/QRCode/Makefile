###############################################################################
# MAKEFILE PATH
###############################################################################
QR_CODE_PATH := ./$(patsubst %/,%,$(dir $(lastword $(MAKEFILE_LIST))))

###############################################################################
# GENERAL PATHS
###############################################################################
QR_CODE_LIB = $(OBJ_PATH)/QRCode.a

###############################################################################
# APPLICATION PATHS
###############################################################################
QR_CODE_SRC_PATH = $(QR_CODE_PATH)/Source

###############################################################################
# Standard directories for C files
###############################################################################
vpath %.c  $(QR_CODE_SRC_PATH)                                                \

##############################################################################
# SOURCES
###############################################################################
QR_CODE_C = $(foreach file,$(wildcard $(QR_CODE_SRC_PATH)/*.c), $(strip $(notdir $(file))))

# Include Makefile for the selected platform
ifneq (,$(wildcard $(QR_CODE_PATH)/Platform/$(PLATFORM)))
	include $(QR_CODE_PATH)/Platform/$(PLATFORM)/Makefile
endif

###############################################################################
# INCLUDES
###############################################################################
INCLUDES += -I$(QR_CODE_PATH)/Include

###############################################################################
# OBJECTS
###############################################################################
QR_CODE_OBJ = $(foreach file,$(QR_CODE_C),  $(OBJ_PATH)/$(strip $(basename $(file))).o)

###############################################################################
# RULES
###############################################################################
QRCode: precompile $(QR_CODE_OBJ)
	@echo Create QRCode library for Platform $(PLATFORM)
	ar qc $(QR_CODE_LIB) $(QR_CODE_OBJ)

include $(wildcard $(patsubst %,%.d,$(basename $(QR_CODE_OBJ))))

# Add QRCode lib
MODULES_LIBS += $(QR_CODE_LIB)